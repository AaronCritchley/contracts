

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PyContracts &mdash; PyContracts v0.9.2 documentation</title>
    <link rel="stylesheet" href="static/default.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="PyContracts v0.9.2 documentation" href="#" />
	 


   <style type="text/css">
   
   </style>

<!--<link  href="http://fonts.googleapis.com/css?family=Lobster" rel="stylesheet" type="text/css" >
<link  href="http://fonts.googleapis.com/css?family=Droid+Serif" rel="stylesheet" type="text/css" >
<link  href="static/pycontracts.css" rel="stylesheet" type="text/css" >-->



  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">PyContracts v0.9.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <a href="http://github.com/AndreaCensi/contracts"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
<div class="section" id="pycontracts">
<h1>PyContracts<a class="headerlink" href="#pycontracts" title="Permalink to this headline">¶</a></h1>
<p><span class="brand">PyContracts</span> is a Python package that allows to declare constraints on function parameters and
return values. It supports a basic type system, variables binding, arithmetic constraints, and
has several specialized contracts (notably for Numpy arrays).</p>
<p><strong>Why</strong>: The purpose of <span class="brand">PyContracts</span> is <strong>not</strong> to turn Python into a statically-typed language
(albeit you can be as strict as you wish), but, rather, to avoid the time-consuming and
obfuscating checking of various preconditions. In fact, more than the type constraints, I found
useful the ability to impose value and size constraints. For example, &#8220;I need a list of at least
3 positive numbers&#8221; can be expressed as <tt class="docutils literal"><span class="pre">list[&gt;=3](number,</span> <span class="pre">&gt;0))</span></tt>. If you find that
<span class="brand">PyContracts</span> is overkill for you, you might want to try a simpler alternative, such as
<a class="reference external" href="http://oakwinter.com/code/typecheck/">typecheck</a>. If you find that <span class="brand">PyContracts</span> is not <em>enough</em> for you, you probably want to be
using <a class="reference external" href="http://www.haskell.org/">Haskell</a> instead of Python.</p>
<p>Contracts can be specified in three ways:</p>
<ul>
<li><p class="first">Using annotations (for Python 3) &#8212;this is perhaps the most
intuitive way:</p>
<div class="highlight-python"><pre>@contracts
def my_function(a : 'int,&gt;0', b : 'list[N],N&gt;0') -&gt; 'list[N]':
     # Requires b to be a nonempty list, and the return
     # value to have the same length.
     ...</pre>
</div>
</li>
<li><p class="first">Using <tt class="docutils literal"><span class="pre">:type:</span></tt> and <tt class="docutils literal"><span class="pre">:rtype:</span></tt> tags in docstrings. In this way, they will be included
in your Sphinx documentation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@contracts</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Function description.</span>
<span class="sd">        :type a: int,&gt;0</span>
<span class="sd">        :type b: list[N],N&gt;0</span>
<span class="sd">        :rtype: list[N]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
<li><p class="first">Using arguments to the decorators; the least intrusive way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@contracts</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;int,&gt;0&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s">&#39;list[N],N&gt;0&#39;</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="s">&#39;list[N]&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</li>
</ul>
<p>Moreover, there are utility functions for manual checking of values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">check</span><span class="p">(</span><span class="s">&#39;array[HxWx3](uint8),H&gt;10,W&gt;10&#39;</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
<p>as well as hooks to extend <span class="brand">PyContracts</span> with new contracts types:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">new_contract</span><span class="p">(</span><span class="s">&#39;valid_name&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<span class="n">check</span><span class="p">(</span><span class="s">&#39;dict(int: (valid_name, int))&#39;</span><span class="p">,</span> <span class="n">employees</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Status:</strong> <span class="brand">PyContracts</span> is very well tested and documented, however I&#8217;m keeping
the version to 0.9, as some slight variations of the syntax are likely to be made
based on users feedback and suggestions.</p>
<p><strong>Support</strong>: use the GitHub issue <a class="reference external" href="http://github.com/AndreaCensi/contracts/issues">tracker</a> or email <a class="reference external" href="http://www.cds.caltech.edu/~andrea/">me</a>.</p>
<p><strong>Documentation index</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#installation"><em>Installation</em></a></li>
<li><a class="reference internal" href="#quick-tour"><em>Quick tour</em></a></li>
<li><a class="reference internal" href="#api"><em>PyContracts API</em></a></li>
<li><a class="reference internal" href="#contracts-language-reference"><em>Language reference</em></a></li>
<li><a class="reference internal" href="#api-reference"><em>PyContracts public API reference</em></a></li>
</ul>
<div class="section" id="installation">
<span id="id1"></span><h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Install <span class="brand">PyContracts</span> using:</p>
<div class="highlight-python"><pre>$ pip install PyContracts</pre>
</div>
<p>or from GitHub:</p>
<div class="highlight-python"><pre>$ git clone git://github.com:AndreaCensi/contracts.git
$ cd contracts
$ python setup.py develop
$ nosetests -w src         # run the extensive test suite</pre>
</div>
<p>The beautiful library <a class="reference external" href="http://pyparsing.wikispaces.com">pyparsing</a> is required.</p>
</div>
<div class="section" id="quick-tour">
<span id="id2"></span><h2>Quick tour<a class="headerlink" href="#quick-tour" title="Permalink to this headline">¶</a></h2>
<p>The contracts are specified using the <tt class="docutils literal"><span class="pre">type</span></tt> clause of RST-style
docstrings (now accepted as standard in the python libraries); or, they can be passed explicitly
to the <tt class="docutils literal"><span class="pre">&#64;contracts</span></tt> decorator. In this example, <span class="brand">PyContracts</span> is smart enough to check that
the two parameters <tt class="docutils literal"><span class="pre">a</span></tt> and <tt class="docutils literal"><span class="pre">b</span></tt> are matrices of compatible dimensions. Then, it checks that
the result value is of compatible dimensions as well.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">contracts</span>

<span class="nd">@contracts</span>
<span class="k">def</span> <span class="nf">matrix_multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span>  <span class="n">b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Multiplies two matrices together.</span>

<span class="sd">        :param a: The first matrix. Must be a 2D array.</span>
<span class="sd">         :type a: array[MxN],M&gt;0,N&gt;0</span>

<span class="sd">        :param b: The second matrix. Must be of compatible dimensions.</span>
<span class="sd">         :type b: array[NxP],P&gt;0</span>

<span class="sd">          :rtype: array[MxP]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="brand">PyContracts</span> can come in handy when you have operations
that could be one-liners if you are sure of the types of
the parameters, but doing all the checking adds to the
complexity of the code.</p>
<p>In the next example we check that:</p>
<ul>
<li><p class="first">The two lists have elements of the same type (indicated by the variable <tt class="docutils literal"><span class="pre">x</span></tt>);</p>
</li>
<li><p class="first">The returned list has the correct size (the sum of the two lengths).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@contracts</span><span class="p">(</span>      <span class="n">a</span><span class="o">=</span><span class="s">&#39;list[ M ](type(x))&#39;</span><span class="p">,</span>
                 <span class="n">b</span><span class="o">=</span><span class="s">&#39;list[ N ](type(x))&#39;</span><span class="p">,</span>
           <span class="n">returns</span><span class="o">=</span><span class="s">&#39;list[M+N](type(x))&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_cat_equal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Concatenate two lists together. &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
</li>
</ul>
<p>The philosophy is to make the simple cases easy, and the difficult
possible, while still retaining readability.</p>
<p>For example, we can either ask for a simple list,
or specify more about it using the additional clauses.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Contract expression</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">list</span></tt></td>
<td>An instance of <tt class="docutils literal"><span class="pre">list</span></tt>.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list[2]</span></tt></td>
<td>A list of two elements.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list(int)</span></tt></td>
<td>A list of integers.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list(number)</span></tt></td>
<td>A list of numbers.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list[3](number)</span></tt></td>
<td>A list of exactly three numbers.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list[&gt;=3](number)</span></tt></td>
<td>A list of at least three numbers.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list[&gt;=3](number,</span> <span class="pre">&gt;0)</span></tt></td>
<td>A list of at least three numbers, greater than 0.</td>
</tr>
</tbody>
</table>
<p><span class="brand">PyContracts</span> supports the use of variables.
There are two kinds of variables: lower-case letters (<tt class="docutils literal"><span class="pre">a</span></tt>, <tt class="docutils literal"><span class="pre">b</span></tt>, ...)
are general-purpose variables, while upper-case letters (<tt class="docutils literal"><span class="pre">A</span></tt>, <tt class="docutils literal"><span class="pre">B</span></tt>, ...)
are constrained to bind to integer types; they are meant to represent
sizes and shapes. Moreover, <span class="brand">PyContracts</span> can do arithmetic and comparisons.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Contract expression</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">tuple(list[N],</span> <span class="pre">list[N])</span></tt></td>
<td>A tuple with two lists of the same length.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">tuple(list[N],</span> <span class="pre">list[M]),</span> <span class="pre">N&lt;M</span></tt></td>
<td>A tuple with two lists, the first one being shorter.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list[&gt;0](type(x))</span></tt></td>
<td>A non-empty list containing elements of all the same type.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">tuple(list(type(x)),</span> <span class="pre">list(type(x)))</span></tt></td>
<td>A tuple with two lists containing objects of the same type.</td>
</tr>
</tbody>
</table>
<p>For the complete reference to the available contract expressions, see <a class="reference internal" href="#contracts-language-reference"><em>Language reference</em></a>.</p>
</div>
</div>
<div class="section" id="pycontracts-api">
<span id="api"></span><h1>PyContracts API<a class="headerlink" href="#pycontracts-api" title="Permalink to this headline">¶</a></h1>
<p>This is a discussion of the <span class="brand">PyContracts</span> API.</p>
<ul class="simple">
<li>See <a class="reference internal" href="#module-contracts" title="contracts"><tt class="xref py py-mod docutils literal"><span class="pre">contracts</span></tt></a> for a detailed list of this module&#8217;s public interface.</li>
<li>See <a class="reference internal" href="#contracts-language-reference"><em>Language reference</em></a> for a description of the domain specific language
used to describe the contracts.</li>
</ul>
<div class="section" id="using-the-contracts-decorator">
<h2>Using the <tt class="docutils literal"><span class="pre">&#64;contracts</span></tt> decorator.<a class="headerlink" href="#using-the-contracts-decorator" title="Permalink to this headline">¶</a></h2>
<p>The decorator <a class="reference internal" href="#module-contracts" title="contracts"><tt class="xref py py-func docutils literal"><span class="pre">contracts()</span></tt></a> is considered the main way to
define constraints. It is quite flexible, and it is smart enough
to support functions with variable number of arguments and keyword arguments.</p>
<p>There are three ways to specify the contracts. In order of precedence:</p>
<ul class="simple">
<li>As arguments to this decorator.</li>
<li>As Python 3 function annotations.</li>
<li>Using <tt class="docutils literal"><span class="pre">:type:</span></tt> and <tt class="docutils literal"><span class="pre">:rtype:</span></tt> tags in the function&#8217;s docstring.</li>
</ul>
<p><span class="brand">PyContracts</span> will try these options in order. Note that, in any case,
only one of these options are chosen. For example, you cannot
use both annotations and docstring for the same function: if annotations
are found, the docstring is not considered.</p>
<div class="section" id="using-decorator-arguments">
<h3>Using decorator arguments<a class="headerlink" href="#using-decorator-arguments" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#module-contracts" title="contracts"><tt class="xref py py-func docutils literal"><span class="pre">contracts()</span></tt></a> accepts a list of keyword arguments.
Each keyword should correspond to one function argument, plus
the special name <tt class="docutils literal"><span class="pre">returns</span></tt> is reserved for describing the return value.
An example use would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">contracts</span>

<span class="nd">@contracts</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;int,&gt;0&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s">&#39;list[N],N&gt;0&#39;</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="s">&#39;list[N]&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>The values can be either:</p>
<ul>
<li><p class="first">Strings using <span class="brand">PyContracts</span>&#8216; DSL language (see <a class="reference internal" href="#contracts-language-reference"><em>Language reference</em></a>)</p>
</li>
<li><p class="first">Python types &#8212; in this case <span class="brand">PyContracts</span> will do a simple <a class="reference external" href="http://docs.python.org/library/functions.html#isinstance" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">isinstance()</span></tt></a> check.
This is slightly more clear if the contract is simple:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@contracts</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="using-python-annotations">
<h3>Using Python annotations<a class="headerlink" href="#using-python-annotations" title="Permalink to this headline">¶</a></h3>
<p>The same rules apply. In this case the syntax would look like this:</p>
<div class="highlight-python"><pre>from contracts import contracts

@contracts
def my_function(a:'int,&gt;0', b:'list[N],N&gt;0') -&gt; 'list[N]':
    ...</pre>
</div>
</div>
<div class="section" id="using-functions-docstrings">
<h3>Using functions docstrings<a class="headerlink" href="#using-functions-docstrings" title="Permalink to this headline">¶</a></h3>
<p>The Python standard library seems to have standardized on the <tt class="docutils literal"><span class="pre">:param:</span></tt>, <tt class="docutils literal"><span class="pre">:type:</span></tt>,
<tt class="docutils literal"><span class="pre">:return:</span></tt>, <tt class="docutils literal"><span class="pre">:rtype:</span></tt> tags to document functions, and tools like Sphinx
can interpret those tags to produce pretty documentation.</p>
<p><span class="brand">PyContracts</span> can read contracts declared using the <tt class="docutils literal"><span class="pre">:type:</span></tt> and <tt class="docutils literal"><span class="pre">:rtype:</span></tt> tags.
In this way, your function becomes automatically more robust and better documented.</p>
<p>Here is an example use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">contracts</span>

<span class="nd">@contracts</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Function description.</span>

<span class="sd">      :param a: first number</span>
<span class="sd">      :type a: int,&gt;0</span>
<span class="sd">      :param b: description of b</span>
<span class="sd">      :type b: list[N],N&gt;0</span>

<span class="sd">      :return: a list</span>
<span class="sd">      :rtype: list[N]               &quot;&quot;&quot;</span>
  <span class="o">...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>By convention, those annotations must be parsable as
reStructuredText.
If the contract string has special RST characters in it, like <tt class="docutils literal"><span class="pre">*</span></tt>,
you can include it in double ticks. <span class="brand">PyContracts</span> will remove
the double ticks before interpreting the string.</p>
<p>For example, the two annotations in this docstring are equivalent
for <span class="brand">PyContracts</span>, but the latter is better for Sphinx:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; My function</span>

<span class="sd">    :param a: First parameter</span>
<span class="sd">    :type a: list(tuple(str,*))</span>

<span class="sd">    :param b: First parameter</span>
<span class="sd">    :type b: ``list(tuple(str,*))``</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="decorating-a-function-explicitly">
<h3>Decorating a function explicitly<a class="headerlink" href="#decorating-a-function-explicitly" title="Permalink to this headline">¶</a></h3>
<p>The public interface of <span class="brand">PyContracts</span> contains a function <a class="reference internal" href="#contracts.decorate" title="contracts.decorate"><tt class="xref py py-func docutils literal"><span class="pre">decorate()</span></tt></a>
that can be used to decorate functions after they are defined.
For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">decorate</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="n">a</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="n">f2</span> <span class="o">=</span> <span class="n">decorate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="s">&#39;list[N],N&gt;1&#39;</span><span class="p">,</span> <span class="n">returns</span><span class="o">=</span><span class="s">&#39;list[N-1]&#39;</span><span class="p">)</span>

<span class="n">f2</span><span class="p">([])</span> <span class="c"># raises exception before pop() is executed</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="manual-api">
<h2>Manual API<a class="headerlink" href="#manual-api" title="Permalink to this headline">¶</a></h2>
<p>In addition to the <a class="reference internal" href="#module-contracts" title="contracts"><tt class="xref py py-func docutils literal"><span class="pre">contracts()</span></tt></a> decorator, <span class="brand">PyContracts</span> offers
an interface for checking expressions explicitly.</p>
<p>The <a class="reference internal" href="#contracts.check" title="contracts.check"><tt class="xref py py-func docutils literal"><span class="pre">check()</span></tt></a> function  allows you to check
that some value respect a given contract.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">check</span>

<span class="n">check</span><span class="p">(</span><span class="s">&#39;tuple(int,int)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#contracts.check" title="contracts.check"><tt class="xref py py-func docutils literal"><span class="pre">check()</span></tt></a> might raise:</p>
<dl class="docutils">
<dt><a class="reference internal" href="#contracts.ContractSyntaxError" title="contracts.ContractSyntaxError"><tt class="xref py py-class docutils literal"><span class="pre">ContractSyntaxError</span></tt></a></dt>
<dd>If there are parsing errors.</dd>
<dt><a class="reference internal" href="#contracts.ContractNotRespected" title="contracts.ContractNotRespected"><tt class="xref py py-class docutils literal"><span class="pre">ContractNotRespected</span></tt></a></dt>
<dd>If the value does not respect the contract constraints.</dd>
</dl>
<p>Both exceptions are instances of <a class="reference internal" href="#contracts.ContractException" title="contracts.ContractException"><tt class="xref py py-class docutils literal"><span class="pre">ContractException</span></tt></a>.
Usually you want to use <a class="reference internal" href="#contracts.check" title="contracts.check"><tt class="xref py py-func docutils literal"><span class="pre">check()</span></tt></a> as a better <tt class="docutils literal"><span class="pre">assert()</span></tt>, so you
don&#8217;t want to catch those exceptions. The error message should
be descriptive enough.</p>
<p>For example, the message generated by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">check</span><span class="p">(</span><span class="s">&#39;tuple(int, tuple(*,str))&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>is</p>
<div class="highlight-python"><pre>contracts.ContractNotRespected: Expected a string, got 'int'.
 context: checking: str                       for value: Instance of int: 2
 context: checking: tuple(*,str)              for value: Instance of tuple: (1, 2)
 context: checking: tuple(int,tuple(*,str))   for value: Instance of tuple: (0, (1, 2))</pre>
</div>
<p>The message shows the recursive matches of expressions, and should be enough
to diagnose the problem. Nevertheless, you can add a third argument to specify a message that will be included
in the error, if one is thrown. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">check</span><span class="p">(</span><span class="s">&#39;tuple(int,int)&#39;</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="s">&#39;Player score must be a tuple of 2 int.&#39;</span> <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="interpreting-error-messages">
<h3>Interpreting error messages<a class="headerlink" href="#interpreting-error-messages" title="Permalink to this headline">¶</a></h3>
<p>In the case you are using variables, the matching &#8220;context&#8221; is shown.
The context is the set of variables which have already bound to values.</p>
<p>For example, suppose you want a tuple with two lists of equal length.
This can be expressed as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">value</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="c"># invalid</span>
<span class="n">check</span><span class="p">(</span><span class="s">&#39;tuple(list[N], list[N])&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>What happens behind the scenes is that <span class="brand">PyContracts</span> first matches the
first list, binds the variable <tt class="docutils literal"><span class="pre">N</span></tt> to the length of that list (=2),
then checks that <tt class="docutils literal"><span class="pre">list[N]</span></tt> describes the second list. Now, however,
<tt class="docutils literal"><span class="pre">N</span></tt> has already been bound, and the matching fails. The error you would see is:</p>
<div class="highlight-python"><pre>contracts.ContractNotRespected: Expected that 'N' = 2, got 3.
 context: checking: N (context: N=2)         for value: Instance of int: 3
 context: checking: list[N] (context: N=2)   for value: Instance of list: [1, 2, 3]
 context: checking: tuple(list[N],list[N])   for value: Instance of tuple: ([0, 1], [1, 2, 3])</pre>
</div>
<p><span class="brand">PyContracts</span> tries hard to give you a readable message even with complicated contracts.
For example, consider the complicated expression:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">check</span><span class="p">(</span><span class="s">&#39;int|str|tuple(str,int)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Because there is an OR (<tt class="docutils literal"><span class="pre">|</span></tt>), <span class="brand">PyContracts</span> will have to explain to you why
none of the three OR clauses was satisfied.</p>
<div class="highlight-python"><pre>contracts.ContractNotRespected: Could not satisfy any of the 3 clauses.
---- Clause #0: ----
| Expected type 'int', got 'tuple'.
|  context: checking: int               for value: Instance of tuple: ('a', 'b')
---- Clause #1: ----
| Expected a string, got 'tuple'.
|  context: checking: str               for value: Instance of tuple: ('a', 'b')
---- Clause #2: ----
| Expected type 'int', got 'str'.
|  context: checking: int               for value: Instance of str: 'b'
|  context: checking: tuple(str,int)    for value: Instance of tuple: ('a', 'b')
------- (end clauses) -------
 context: checking: int|str|tuple(str,int)   for value: Instance of tuple: ('a', 'b')</pre>
</div>
</div>
<div class="section" id="explicit-parsing-and-checking">
<h3>Explicit parsing and checking<a class="headerlink" href="#explicit-parsing-and-checking" title="Permalink to this headline">¶</a></h3>
<p>The results of parsing are cached internally, there is no performance
penalty in using <a class="reference internal" href="#contracts.check" title="contracts.check"><tt class="xref py py-func docutils literal"><span class="pre">check()</span></tt></a>  often.</p>
<p>If you wish, you can also separate the parsing and checking phases.
The function <a class="reference internal" href="#contracts.parse" title="contracts.parse"><tt class="xref py py-func docutils literal"><span class="pre">parse()</span></tt></a> will return a <a class="reference internal" href="#contracts.Contract" title="contracts.Contract"><tt class="xref py py-class docutils literal"><span class="pre">Contract</span></tt></a> object,
which in turn has a <a class="reference internal" href="#contracts.Contract.check" title="contracts.Contract.check"><tt class="xref py py-func docutils literal"><span class="pre">Contract.check()</span></tt></a> function you can call.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">parse</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s">&#39;&gt;0&#39;</span><span class="p">)</span>  <span class="c"># May raise ContractSyntaxError</span>
<span class="n">contract</span><span class="o">.</span><span class="n">check</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>       <span class="c"># May raise ContractNotRespected</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-multiple-values">
<h3>Checking multiple values<a class="headerlink" href="#checking-multiple-values" title="Permalink to this headline">¶</a></h3>
<p>The most interesting uses of <span class="brand">PyContracts</span> are when it is used
to check that multiple objects respect mutual constraints.</p>
<p>You can use <a class="reference internal" href="#contracts.check_multiple" title="contracts.check_multiple"><tt class="xref py py-func docutils literal"><span class="pre">check_multiple()</span></tt></a> to check that a series of values
respect a series of contracts, that might reference each other&#8217;s variables.
The argument to  <a class="reference internal" href="#contracts.check_multiple" title="contracts.check_multiple"><tt class="xref py py-func docutils literal"><span class="pre">check_multiple()</span></tt></a> must be a list of tuples with two elements
(contract, value).</p>
<p>In the next example, we are defining a table. We want <tt class="docutils literal"><span class="pre">data</span></tt>
to be a list of lists with equal length, and that
<tt class="docutils literal"><span class="pre">row_labels</span></tt> and <tt class="docutils literal"><span class="pre">col_labels</span></tt> have the expected
length, coherent with <tt class="docutils literal"><span class="pre">data</span></tt>. <span class="brand">PyContracts</span> allows you
to do all this checks with a remarkably clear, concise, and readable notation.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">check_multiple</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span>
<span class="n">row_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;first season&#39;</span><span class="p">,</span> <span class="s">&#39;second season&#39;</span><span class="p">]</span>
<span class="n">col_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Team1&#39;</span><span class="p">,</span> <span class="s">&#39;Team2&#39;</span><span class="p">,</span> <span class="s">&#39;Team3&#39;</span><span class="p">]</span>

<span class="n">check_multiple</span><span class="p">([(</span><span class="s">&#39;list[C](str),C&gt;0&#39;</span><span class="p">,</span> <span class="n">col_labels</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;list[R](str),R&gt;0&#39;</span><span class="p">,</span> <span class="n">row_labels</span><span class="p">),</span>
                <span class="p">(</span><span class="s">&#39;list[R](list[C](numbers))&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="p">],</span>
               <span class="s">&#39;I expect col_labels, row_labels, and data to &#39;</span>
               <span class="s">&#39;have coherent dimensions.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="examining-the-contract-objects">
<h3>Examining the Contract objects<a class="headerlink" href="#examining-the-contract-objects" title="Permalink to this headline">¶</a></h3>
<p>If you want to examine the contract object, use <a class="reference internal" href="#contracts.Contract.__repr__" title="contracts.Contract.__repr__"><tt class="xref py py-func docutils literal"><span class="pre">Contract.__repr__()</span></tt></a>
for eval()uable expression,
or <a class="reference internal" href="#contracts.Contract.__str__" title="contracts.Contract.__str__"><tt class="xref py py-func docutils literal"><span class="pre">Contract.__str__()</span></tt></a>  to get back a representation using <span class="brand">PyContracts</span>&#8216; language.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">parse</span>

<span class="n">contract</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s">&#39; list[N](int), N &gt; 0&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">contract</span><span class="p">)</span>   <span class="c"># =&gt; &#39;list[N](int),N&gt;0&#39;</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">contract</span><span class="p">)</span>
<span class="c"># =&gt; And([List(BindVariable(&#39;N&#39;,int),CheckType(int)),</span>
<span class="c">#         CheckOrder(VariableRef(&#39;N&#39;),&#39;&gt;&#39;,SimpleRValue(0))])</span>
</pre></div>
</div>
<p>The latter is useful if you are hacking <span class="brand">PyContracts</span> and you
want to check in detail what is going on.</p>
</div>
<div class="section" id="examining-bound-variables">
<h3>Examining bound variables<a class="headerlink" href="#examining-bound-variables" title="Permalink to this headline">¶</a></h3>
<p>If you are using binding expression, you can examine
what variables were bound using the return values.
The functions <a class="reference internal" href="#contracts.check" title="contracts.check"><tt class="xref py py-func docutils literal"><span class="pre">check()</span></tt></a> and <a class="reference internal" href="#contracts.Contract.check" title="contracts.Contract.check"><tt class="xref py py-func docutils literal"><span class="pre">Contract.check()</span></tt></a> will return
a <a class="reference internal" href="#contracts.Context" title="contracts.Context"><tt class="xref py py-class docutils literal"><span class="pre">Context</span></tt></a> object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">context</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="s">&#39;list[N](str), N&gt;0&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="s">&#39;N&#39;</span> <span class="ow">in</span> <span class="n">context</span><span class="p">)</span>  <span class="c"># =&gt; True</span>
<span class="k">print</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;N&#39;</span><span class="p">])</span>    <span class="c"># =&gt; 3</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="extending-pycontracts-with-new-contracts">
<h2>Extending <span class="brand">PyContracts</span> with new contracts<a class="headerlink" href="#extending-pycontracts-with-new-contracts" title="Permalink to this headline">¶</a></h2>
<p>Defines a new contract type. The second parameter can be either
a string or a callable function.</p>
<ul>
<li><p class="first">If it is a string, it is interpreted as contract expression;
the given identifier will become an alias
for that expression.</p>
</li>
<li><p class="first">If it is a callable, it must accept one parameter, and either:</p>
<ul class="simple">
<li>return True or None, to signify it accepts.</li>
<li>return False or raise ValueError, to signify it doesn&#8217;t.</li>
</ul>
<p>If ValueError is raised, its message is used in the error.</p>
</li>
</ul>
<p>This function returns a <a class="reference internal" href="#contracts.Contract" title="contracts.Contract"><tt class="xref py py-class docutils literal"><span class="pre">Contract</span></tt></a> object. It might be
useful to check right away if the declaration is what you meant,
using <a class="reference internal" href="#contracts.Contract.check" title="contracts.Contract.check"><tt class="xref py py-func docutils literal"><span class="pre">Contract.check()</span></tt></a> and <a class="reference internal" href="#contracts.Contract.fail" title="contracts.Contract.fail"><tt class="xref py py-func docutils literal"><span class="pre">Contract.fail()</span></tt></a>.</p>
<p>For example, suppose that you are writing a graphical application
and that many of your functions need arguments representing colors.
It might be a good idea to declare once and for all what is a color,
and then reuse that definition. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">color</span> <span class="o">=</span> <span class="n">new_contract</span><span class="p">(</span><span class="s">&#39;color&#39;</span><span class="p">,</span> <span class="s">&#39;list[3](number,&gt;=0,&lt;=1)&#39;</span><span class="p">)</span>
<span class="c"># Make sure we got it right</span>
<span class="n">color</span><span class="o">.</span><span class="n">check</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">color</span><span class="o">.</span><span class="n">check</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">color</span><span class="o">.</span><span class="n">fail</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">color</span><span class="o">.</span><span class="n">fail</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

<span class="c"># Now use ``color`` in other contracts.</span>
<span class="nd">@contracts</span>
<span class="k">def</span> <span class="nf">fill_area</span><span class="p">(</span><span class="n">inside</span><span class="p">,</span> <span class="n">border</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Fill the area inside the current figure.</span>

<span class="sd">        :type border: color</span>
<span class="sd">        :type inside: color              &quot;&quot;&quot;</span>
    <span class="o">...</span>

<span class="nd">@contracts</span>
<span class="k">def</span> <span class="nf">fill_gradient</span><span class="p">(</span><span class="n">colors</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Use a gradient to fill the area.</span>

<span class="sd">        :type colors: list[&gt;=2](color)     &quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="using-pycontracts-in-your-own-pyparsing-based-language">
<h2>Using PyContracts in your own PyParsing-based language<a class="headerlink" href="#using-pycontracts-in-your-own-pyparsing-based-language" title="Permalink to this headline">¶</a></h2>
<p>You can use <a class="reference internal" href="#contracts.contract_expression" title="contracts.contract_expression"><tt class="xref py py-data docutils literal"><span class="pre">contract_expression</span></tt></a> to add a contract expression
to your PyParsing-based grammar:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">contract_expression</span>

<span class="kn">from</span> <span class="nn">pyparsing</span> <span class="kn">import</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span>

<span class="n">my_grammar</span> <span class="o">=</span> <span class="o">...</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="s">&#39;respects&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">contract_expression</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="language-reference">
<span id="contracts-language-reference"></span><h1>Language reference<a class="headerlink" href="#language-reference" title="Permalink to this headline">¶</a></h1>
<p>This section describes <span class="brand">PyContracts</span>&#8216; language for specifying contracts.</p>
<ul class="simple">
<li>See <a class="reference internal" href="#quick-tour"><em>Quick tour</em></a> for a summary of the available features.</li>
<li>See <a class="reference internal" href="#api"><em>PyContracts API</em></a> for a description of the API.</li>
</ul>
<div class="section" id="simple-types">
<h2>Simple types<a class="headerlink" href="#simple-types" title="Permalink to this headline">¶</a></h2>
<p>The simplest kind of contract consists in declaring the type
of a value. These are the supported primitive types:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="bp">None</span>
</pre></div>
</div>
<p>Moreover, there are two kinds of wild-cards:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">*</span></tt></dt>
<dd>Matches any object.</dd>
<dt><tt class="docutils literal"><span class="pre">#</span></tt></dt>
<dd>Never matches anything &#8212; useful for debugging.</dd>
</dl>
</div>
<div class="section" id="variables">
<h2>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h2>
<p><span class="brand">PyContracts</span> allows to use variables to bind to sub-expressions
and reuse later (it is simpler than it sounds).</p>
<p>There are two kinds of variables. The first kind is denoted
by an uppercase letter, and it is constrained to bind to integer values.</p>
<div class="highlight-python"><pre>A B C D E F G H I J K L M N O P Q R S T U W V X Y Z</pre>
</div>
<p>Lower-case letters denote general-purpose variables that can bind to any type:</p>
<div class="highlight-python"><pre>a b c d e f g h i j k l m n o p q r s t u w v x y z</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The reason for having specialized variables for integers is
to encourage a writing style in which uppercase letters denote
lengths, shapes, etc. Moreover, an error will be thrown if they do not
bind to integers, which helps in catching mistakes.</p>
</div>
</div>
<div class="section" id="logical-expressions">
<h2>Logical expressions<a class="headerlink" href="#logical-expressions" title="Permalink to this headline">¶</a></h2>
<p>Two logical operators are supported:</p>
<dl class="docutils">
<dt>AND</dt>
<dd><p class="first">Expressed with a comma (<tt class="docutils literal"><span class="pre">,</span></tt>).</p>
<p>For example, the expression</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">check</span><span class="p">(</span><span class="s">&quot;contract1,contract2&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>is roughly equivalent to</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">check</span><span class="p">(</span><span class="s">&quot;contract1&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="n">check</span><span class="p">(</span><span class="s">&quot;contract2&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">except that variables in the contracts are evaluated in the same context.</p>
</dd>
<dt>OR</dt>
<dd><p class="first">Expressed with a pipe symbol (<tt class="docutils literal"><span class="pre">|</span></tt>).</p>
<p>The semantic is that the first matching expression is chosen.</p>
<p>The expression:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">check</span><span class="p">(</span><span class="s">&quot;contract1|contract2&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>
</div>
<p>is roughly equivalent to:</p>
<div class="last highlight-python"><pre>if value respects "contract1":
   return True
elif value respects "contract2":
   return True
else:
   return False</pre>
</div>
</dd>
</dl>
<p>The AND has precedence over OR. For example, the expression</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">|</span><span class="n">c</span>
</pre></div>
</div>
<p>is evaluated the same as</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">|</span> <span class="n">c</span>
</pre></div>
</div>
<table border="1" class="docutils">
<caption>Examples of contracts with logical operators</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Contract expression</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">None|int</span></tt></td>
<td>Either None or an integer.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="equality">
<h2>Equality<a class="headerlink" href="#equality" title="Permalink to this headline">¶</a></h2>
<p><span style="font-weight:bold">This section must still be written.</span></p>
</div>
<div class="section" id="arithmetic-and-comparison">
<h2>Arithmetic and comparison<a class="headerlink" href="#arithmetic-and-comparison" title="Permalink to this headline">¶</a></h2>
<p><span style="font-weight:bold">This section must still be written.</span></p>
</div>
<div class="section" id="details-of-variable-binding">
<h2>Details of variable binding<a class="headerlink" href="#details-of-variable-binding" title="Permalink to this headline">¶</a></h2>
<p><span style="font-weight:bold">This section must still be written.</span></p>
</div>
<div class="section" id="lists">
<h2>Lists<a class="headerlink" href="#lists" title="Permalink to this headline">¶</a></h2>
<p>You can specify that the value must be a list, and
specify optional constraints for its length and for its elements.</p>
<p>The general syntax is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">list</span>
<span class="nb">list</span><span class="p">[</span><span class="n">length_contract</span><span class="p">]</span>
<span class="nb">list</span><span class="p">(</span><span class="n">elements_contract</span><span class="p">)</span>
<span class="nb">list</span><span class="p">[</span><span class="n">length_contract</span><span class="p">](</span><span class="n">elements_contract</span><span class="p">)</span>
</pre></div>
</div>
<table border="1" class="docutils">
<caption>Examples of <tt class="docutils literal"><span class="pre">list</span></tt> contracts</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Contract expression</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">list</span></tt></td>
<td>An instance of <tt class="docutils literal"><span class="pre">list</span></tt>.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list[2]</span></tt></td>
<td>A list of two elements.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list(int)</span></tt></td>
<td>A list of integers.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list(number)</span></tt></td>
<td>A list of numbers.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list[3](number)</span></tt></td>
<td>A list of exactly three numbers.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list[&gt;=3](number)</span></tt></td>
<td>A list of at least three numbers.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list[&gt;=3](number,</span> <span class="pre">&gt;0)</span></tt></td>
<td>A list of at least three numbers, greater than 0.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">tuple(list[N],</span> <span class="pre">list[N])</span></tt></td>
<td>A tuple of two lists of the same length.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tuples">
<h2>Tuples<a class="headerlink" href="#tuples" title="Permalink to this headline">¶</a></h2>
<p>You can either specify a length (with square brackets),
or specify a contract for each element:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">tuple</span>

<span class="nb">tuple</span><span class="p">[</span><span class="n">length</span><span class="p">]</span>

<span class="nb">tuple</span><span class="p">(</span><span class="n">element1</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">elementN</span><span class="p">)</span>
</pre></div>
</div>
<p>In the latter case, you are also specifying implicitly the number of elements.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The syntax for tuples is somewhat a special case.
While <tt class="docutils literal"><span class="pre">list(int,&gt;0)</span></tt> signifies a list
of positive integers (or empty list), <tt class="docutils literal"><span class="pre">tuple(int,</span> <span class="pre">&gt;0)</span></tt>
means a tuple with exactly 2 elements, the first of which
should be an integer, and the second must be positive (but not necessarily integer.)</p>
</div>
<table border="1" class="docutils">
<caption>Examples of <tt class="docutils literal"><span class="pre">tuple</span></tt> contracts</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Contract expression</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">tuple</span></tt></td>
<td>A tuple.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">tuple[2]</span></tt></td>
<td>A tuple with two elements.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">tuple(*,*)</span></tt></td>
<td>A tuple with two elements.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">tuple(int)</span></tt></td>
<td>A tuple with one integer element.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">tuple(int,</span> <span class="pre">int)</span></tt></td>
<td>A tuple with two integer elements.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">tuple[&gt;=2]</span></tt></td>
<td>A tuple with at least two elements.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dictionaries">
<h2>Dictionaries<a class="headerlink" href="#dictionaries" title="Permalink to this headline">¶</a></h2>
<p>For dictionary, you can specify a length contract, as well as a contract
for its keys and values:</p>
<div class="highlight-python"><pre>dict

dict[length_contract]

dict(key_contract: value_contract)

dict[length_contract](key_contract: value_contract)</pre>
</div>
<table border="1" class="docutils">
<caption>Examples of <tt class="docutils literal"><span class="pre">dict</span></tt> contracts</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Contract expression</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">dict</span></tt></td>
<td>Any dictionary.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">dict[2]</span></tt></td>
<td>A dictionary with two elements.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">dict(*:</span> <span class="pre">*)</span></tt></td>
<td>Any dictionary.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">dict(*:</span> <span class="pre">int)</span></tt></td>
<td>A dictionary whose values are integers.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">dict(str:</span> <span class="pre">*)</span></tt></td>
<td>A dictionary whose keys are strings</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">dict(str:</span> <span class="pre">tuple(type(x),type(y))</span> <span class="pre">),</span> <span class="pre">x!=y</span></tt></td>
<td>A dictionary whose keys are strings, and whose values
are tuples with two elements, of two different types <tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="numpy-arrays">
<h2>Numpy arrays<a class="headerlink" href="#numpy-arrays" title="Permalink to this headline">¶</a></h2>
<p>The support for Numpy arrays was one of the motivations for me to develop <span class="brand">PyContracts</span>.
<a class="reference external" href="http://numpy.scipy.org/">Numpy</a> is one of the best and most useful Python packages around. It supports
the <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.html">ndarray</a> datatype which allows for operations with <a class="reference external" href="http://en.wikipedia.org/wiki/Tensor">tensors</a> of arbitrary dimensions.</p>
<p>All of that is very powerful, but it might be a bit confusing, especially
because Numpy tends to be very liberal when it gets to operations between arrays.
For example, the operation <tt class="docutils literal"><span class="pre">A</span> <span class="pre">*</span> <span class="pre">B</span></tt>, if <tt class="docutils literal"><span class="pre">A</span></tt> is a 2D matrix, is well defined
when <tt class="docutils literal"><span class="pre">B</span></tt> is a scalar, a vector, or a matrix. Sometimes you want to be certain
of your assumptions, otherwise you risk of ignoring powerful bugs.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Researchers tend to be a bit paranoid, because often
you don&#8217;t know what to expect out of your algorithms. A stupid
bug can lead to an exciting (false) discovery!</p>
</div>
<p>So <span class="brand">PyContracts</span> offers several shortcuts for Numpy arrays, and
the error messages tend to be more descriptive.</p>
<p>The general syntax looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span>

<span class="n">array</span><span class="p">[</span><span class="n">shape_contract</span><span class="p">]</span>

<span class="n">array</span><span class="p">(</span><span class="n">numpy_contract</span><span class="p">)</span>

<span class="n">array</span><span class="p">[</span><span class="n">shape_contract</span><span class="p">](</span><span class="n">numpy_contract</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="shape-contracts">
<h3>Shape contracts<a class="headerlink" href="#shape-contracts" title="Permalink to this headline">¶</a></h3>
<p>A <em>shape contract</em> is specified using a special syntax of the kind:</p>
<blockquote>
<p>dimension1 x dimension2 x dimension3</p>
<p>dimension1 x dimension2 x dimension3 x ...</p>
</blockquote>
<p>The ellipsis is part of the syntax and specifies that more dimensions are allowed.</p>
<p>Each dimension can be specified as a number, with variables, or as a contract.</p>
<table border="1" class="docutils">
<caption>Examples of <tt class="docutils literal"><span class="pre">array</span></tt> shape contracts</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Contract expression</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">array</span></tt></td>
<td>Any array.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">array[3]</span></tt></td>
<td>A 1D array with 3 elements (<tt class="docutils literal"><span class="pre">shape=(3,)</span></tt>).</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">array[3x2]</span></tt></td>
<td>A 2D array with 3 rows and 2 columns (<tt class="docutils literal"><span class="pre">shape=(3,2)</span></tt>).</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">array[3</span> <span class="pre">x</span> <span class="pre">...]</span></tt></td>
<td>A nD array with 3 rows and arbitrary other dimensions.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">array[3xN],</span> <span class="pre">N&gt;=2</span></tt></td>
<td>A 2D array with 3 rows and at least 2 columns.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">array[NxN],</span> <span class="pre">N&gt;0</span></tt></td>
<td>A square matrix.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">array[NxNx...],</span> <span class="pre">N&gt;0</span></tt></td>
<td>A tensor with the first two dimensions of equal size.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list(array[NxN]),</span> <span class="pre">N&gt;0</span></tt></td>
<td>A list of square matrices of the same size.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="numpy-specific-contracts">
<h3>Numpy-specific contracts<a class="headerlink" href="#numpy-specific-contracts" title="Permalink to this headline">¶</a></h3>
<p>A <em>numpy contract</em> is special and implemented separately
from the other <span class="brand">PyContracts</span> contract.
Right now, we support:</p>
<dl class="docutils">
<dt>Datatype contracts</dt>
<dd><p class="first">These specify the datatype of the array. Available:</p>
<div class="last highlight-python"><pre>uint8 uint16 uint32 uint64 int8 int16 int32  int64 float32 float64</pre>
</div>
</dd>
<dt>Arithmetic comparisons</dt>
<dd><p class="first">These have the semantics that <strong>all</strong> elements must satisfy the contract.
They appear similar to the normal <span class="brand">PyContracts</span> comparison:</p>
<div class="last highlight-python"><pre>&gt;0   &lt;0   &lt;=1   =0</pre>
</div>
</dd>
</dl>
<table border="1" class="docutils">
<caption>Examples of <tt class="docutils literal"><span class="pre">array</span></tt> elements contracts</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Contract expression</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">array</span></tt></td>
<td>Any array.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">array(&gt;=0)</span></tt></td>
<td>An array with nonnegative elements.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">array(int8,&gt;=0)</span></tt></td>
<td>An array with nonnegative integer elements.</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">array[NxN](float,&gt;=0,&lt;=1)</span></tt></td>
<td>A square matrix with float elements in the interval [0,1].</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="other-examples">
<h3>Other examples<a class="headerlink" href="#other-examples" title="Permalink to this headline">¶</a></h3>
<p>Here is an example that first uses <a class="reference internal" href="#contracts.new_contract" title="contracts.new_contract"><tt class="xref py py-func docutils literal"><span class="pre">new_contract()</span></tt></a> to specify
a domain-specific array type (<tt class="docutils literal"><span class="pre">rgb</span></tt>, <tt class="docutils literal"><span class="pre">rgba</span></tt>), then uses <span class="brand">PyContracts</span>
to be sure that the two given images and the result values have coherent dimensions.
Notice how the contracts serve very well as documentation.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">contracts</span><span class="p">,</span> <span class="n">new_contract</span>

<span class="n">new_contract</span><span class="p">(</span><span class="s">&#39;rgb&#39;</span><span class="p">,</span>  <span class="s">&#39;array[HxWx3](uint8),H&gt;0,W&gt;0&#39;</span><span class="p">)</span>
<span class="n">new_contract</span><span class="p">(</span><span class="s">&#39;rgba&#39;</span><span class="p">,</span> <span class="s">&#39;array[HxWx4](uint8),H&gt;0,W&gt;0&#39;</span><span class="p">)</span>

<span class="nd">@contracts</span>
<span class="k">def</span> <span class="nf">blend_images</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">         Blends two images together.</span>

<span class="sd">         :param image1: The first image to blend.</span>
<span class="sd">         :type image1: rgb,array[HxWx*]</span>

<span class="sd">         :param image2: The second image to blend. Can have an alpha layer.</span>
<span class="sd">         :type image2: (rgb|rgba),array[HxWx*]</span>

<span class="sd">         :return: The blended image.</span>
<span class="sd">         :rtype: rgb,array[HxWx3]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>If you want to have a function that accepts a list of images, you would write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@contracts</span>
<span class="k">def</span> <span class="nf">blend_images</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">         Blends a series of images together.</span>

<span class="sd">         :type images: list[N](rgb,array[HxWx*]), N&gt;=2</span>

<span class="sd">         :rtype: rgb,array[HxWx3]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="advanced-topic-the-context-isolate-operator">
<h2>Advanced topic: the context isolate operator<a class="headerlink" href="#advanced-topic-the-context-isolate-operator" title="Permalink to this headline">¶</a></h2>
<p><span class="brand">PyContracts</span> has a special construct <tt class="docutils literal"><span class="pre">$(...)</span></tt> used to separate the context
of variables. The semantics is that the variables assigned inside <tt class="docutils literal"><span class="pre">$(...)</span></tt>
are not propagated outside.</p>
<table border="1" class="docutils">
<caption>Examples of <tt class="docutils literal"><span class="pre">$()</span></tt> contracts</caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Contract expression</th>
<th class="head">Meaning</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">list(tuple(type(x),type(y)),x!=y)</span></tt></td>
<td>A list whose elements
are tuples with two elements, of two different types <tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt>
(<tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt> are common among the list elements ).</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">list(</span> <span class="pre">$(</span> <span class="pre">tuple(type(x),type(y)),x!=y)</span> <span class="pre">)</span></tt></td>
<td>A list whose elements
are tuples with two elements, of two different types <tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt>.
(<tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt> are not joined among the list elements ).</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="pycontracts-public-api-reference">
<span id="api-reference"></span><h1>PyContracts public API reference<a class="headerlink" href="#pycontracts-public-api-reference" title="Permalink to this headline">¶</a></h1>
<p>This section provides a reference to <span class="brand">PyContracts</span>&#8216; public interface.</p>
<ul class="simple">
<li>See <a class="reference internal" href="#api"><em>PyContracts API</em></a> for a more friendly discussion.</li>
<li>See <a class="reference internal" href="#contracts-language-reference"><em>Language reference</em></a> for a reference on the domain-specific language.</li>
</ul>
<span class="target" id="module-contracts"></span><div class="section" id="decorating-a-function">
<h2>Decorating a function<a class="headerlink" href="#decorating-a-function" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="contracts.contracts">
<tt class="descclassname">contracts.</tt><tt class="descname">contracts</tt><big>(</big><em>*arg</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#contracts.contracts" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator for adding contracts to functions.</p>
<p>It is smart enough to support functions with variable number of arguments
and keyword arguments.</p>
<p>There are three ways to specify the contracts. In order of precedence:</p>
<ul>
<li><p class="first">As arguments to this decorator. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@contracts</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;int,&gt;0&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s">&#39;list[N],N&gt;0&#39;</span><span class="p">,</span><span class="n">returns</span><span class="o">=</span><span class="s">&#39;list[N]&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">pass</span>
</pre></div>
</div>
</li>
<li><p class="first">As annotations (supported only in Python 3):</p>
<div class="highlight-python"><pre>@contracts
def my_function(a:'int,&gt;0', b:'list[N],N&gt;0') -&gt; 'list[N]': 
    # ...
    pass</pre>
</div>
</li>
<li><p class="first">Using <tt class="docutils literal"><span class="pre">:type:</span></tt> and <tt class="docutils literal"><span class="pre">:rtype:</span></tt> tags in the function&#8217;s docstring:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@contracts</span>
<span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot; Function description.</span>
<span class="sd">        :type a: int,&gt;0</span>
<span class="sd">        :type b: list[N],N&gt;0</span>
<span class="sd">        :rtype: list[N]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</li>
</ul>
<p><strong>Contracts evaluation</strong>: Note that all contracts for the arguments 
and the return values
are evaluated in the same context. This make it possible to use
common variables in the contract expression. For example, in the example
above, the return value is constrained to be a list of the same 
length (<tt class="docutils literal"><span class="pre">N</span></tt>) as the parameter <tt class="docutils literal"><span class="pre">b</span></tt>.</p>
<p><strong>Using docstrings</strong> Note that, by convention, those annotations must 
be parseable as RestructuredText. This is relevant if you are using Sphinx.
If the contract string has special RST characters in it, like <tt class="docutils literal"><span class="pre">*</span></tt>,
you can include it in double ticks. <span class="brand">PyContracts</span> will remove
the double ticks before interpreting the string.</p>
<p>For example, the two annotations in this docstring are equivalent
for <span class="brand">PyContracts</span>, but the latter is better for Sphinx:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; My function </span>

<span class="sd">    :param a: First parameter</span>
<span class="sd">    :type a: list(tuple(str,*))</span>
<span class="sd">    </span>
<span class="sd">    :param b: First parameter</span>
<span class="sd">    :type b: ``list(tuple(str,*))``</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Raise :</th><td class="field-body">ContractException, if arguments are not coherent with the function</td>
</tr>
<tr class="field"><th class="field-name">Raise :</th><td class="field-body">ContractSyntaxError</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="contracts.decorate">
<tt class="descclassname">contracts.</tt><tt class="descname">decorate</tt><big>(</big><em>function</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#contracts.decorate" title="Permalink to this definition">¶</a></dt>
<dd><p>An explicit way to decorate a given function.
The decorator <a class="reference internal" href="#contracts.decorate" title="contracts.decorate"><tt class="xref py py-func docutils literal"><span class="pre">decorate()</span></tt></a> calls this function internally.</p>
</dd></dl>

</div>
<div class="section" id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="contracts.ContractException">
<em class="property">class </em><tt class="descclassname">contracts.</tt><tt class="descname">ContractException</tt><a class="headerlink" href="#contracts.ContractException" title="Permalink to this definition">¶</a></dt>
<dd><p>The base class for the exceptions thrown by this module.</p>
</dd></dl>

<dl class="class">
<dt id="contracts.ContractSyntaxError">
<em class="property">class </em><tt class="descclassname">contracts.</tt><tt class="descname">ContractSyntaxError</tt><big>(</big><em>error</em>, <em>where=None</em><big>)</big><a class="headerlink" href="#contracts.ContractSyntaxError" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception thrown when there is a syntax error in the contracts.</p>
</dd></dl>

<dl class="class">
<dt id="contracts.ContractNotRespected">
<em class="property">class </em><tt class="descclassname">contracts.</tt><tt class="descname">ContractNotRespected</tt><big>(</big><em>contract</em>, <em>error</em>, <em>value</em>, <em>context</em><big>)</big><a class="headerlink" href="#contracts.ContractNotRespected" title="Permalink to this definition">¶</a></dt>
<dd><p>Exception thrown when a value does not respect a contract.</p>
</dd></dl>

</div>
<div class="section" id="manually-checking-values">
<h2>Manually checking values<a class="headerlink" href="#manually-checking-values" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="contracts.check">
<tt class="descclassname">contracts.</tt><tt class="descname">check</tt><big>(</big><em>contract</em>, <em>object</em>, <em>desc=None</em><big>)</big><a class="headerlink" href="#contracts.check" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks that <tt class="docutils literal"><span class="pre">object</span></tt> satisfies the contract described by <tt class="docutils literal"><span class="pre">contract</span></tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>contract</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The contract string.</li>
<li><strong>object</strong> (<tt class="docutils literal"><span class="pre">*</span></tt>) &#8211; Any object.</li>
<li><strong>desc</strong> (<tt class="docutils literal"><span class="pre">None|str</span></tt>) &#8211; An optional description of the error. If given, 
it is included in the error message.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="contracts.check_multiple">
<tt class="descclassname">contracts.</tt><tt class="descname">check_multiple</tt><big>(</big><em>couples</em>, <em>desc=None</em><big>)</big><a class="headerlink" href="#contracts.check_multiple" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks multiple couples of (contract, value) in the same context.</p>
<p>This means that the variables in each contract are shared with 
the others.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>couples</strong> (<tt class="docutils literal"><span class="pre">list[&gt;0](tuple(str,</span> <span class="pre">*))</span></tt>) &#8211; A list of tuple (contract, value) to check.</li>
<li><strong>desc</strong> (<tt class="docutils literal"><span class="pre">None|str</span></tt>) &#8211; An optional description of the error. If given, 
it is included in the error message.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="contracts.parse">
<tt class="descclassname">contracts.</tt><tt class="descname">parse</tt><big>(</big><em>spec</em><big>)</big><a class="headerlink" href="#contracts.parse" title="Permalink to this definition">¶</a></dt>
<dd><p>spec can be either a type or a contract string. 
In the latter case, the usual parsing takes place</p>
</dd></dl>

<dl class="function">
<dt id="contracts.new_contract">
<tt class="descclassname">contracts.</tt><tt class="descname">new_contract</tt><big>(</big><em>*args</em><big>)</big><a class="headerlink" href="#contracts.new_contract" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines a new contract type. Used both as a decorator and as 
a function.</p>
<p><strong>1) Use as a function.</strong> The first parameter must be a string. 
The second parameter can be either
a string or a callable function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">new_contract</span><span class="p">(</span><span class="s">&#39;new_contract_name&#39;</span><span class="p">,</span> <span class="s">&#39;list[N]&#39;</span><span class="p">)</span> 
<span class="n">new_contract</span><span class="p">(</span><span class="s">&#39;new_contract_name&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p class="first">If it is a string, it is interpreted as contract expression; 
the given identifier will become an alias
for that expression.</p>
</li>
<li><p class="first">If it is a callable, it must accept one parameter, and either:</p>
<ul class="simple">
<li>return True or None, to signify it accepts.</li>
<li>return False or raise ValueError or AssertionError, 
to signify it doesn&#8217;t.</li>
</ul>
<p>If ValueError is raised, its message is used in the error.</p>
</li>
</ul>
<p><strong>2) Use as a decorator.</strong></p>
<p>Or, it can be used as a decorator (without arguments).
The function name is used as the identifier.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@new_contract</span>
<span class="k">def</span> <span class="nf">new_contract_name</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<p>This function returns a <a class="reference internal" href="#contracts.Contract" title="contracts.Contract"><tt class="xref py py-class docutils literal"><span class="pre">Contract</span></tt></a> object. It might be
useful to check right away if the declaration is what you meant,
using <a class="reference internal" href="#contracts.Contract.check" title="contracts.Contract.check"><tt class="xref py py-func docutils literal"><span class="pre">Contract.check()</span></tt></a> and <a class="reference internal" href="#contracts.Contract.fail" title="contracts.Contract.fail"><tt class="xref py py-func docutils literal"><span class="pre">Contract.fail()</span></tt></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>identifier</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The identifier must be a string not already in use
(you cannot redefine <tt class="docutils literal"><span class="pre">list</span></tt>, <tt class="docutils literal"><span class="pre">tuple</span></tt>, etc.).</li>
<li><strong>condition</strong> (<tt class="docutils literal"><span class="pre">type|callable|str</span></tt>) &#8211; Definition of the new contract.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The equivalent contract &#8211; might be useful for debugging.</p>
</td>
</tr>
<tr class="field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Contract</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="contracts.Contract">
<em class="property">class </em><tt class="descclassname">contracts.</tt><tt class="descname">Contract</tt><big>(</big><em>where</em><big>)</big><a class="headerlink" href="#contracts.Contract" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="contracts.Contract.check">
<tt class="descname">check</tt><big>(</big><em>value</em><big>)</big><a class="headerlink" href="#contracts.Contract.check" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks that the value satisfies this contract.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Raise :</th><td class="field-body">ContractNotRespected</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="contracts.Contract.fail">
<tt class="descname">fail</tt><big>(</big><em>value</em><big>)</big><a class="headerlink" href="#contracts.Contract.fail" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt>Checks that the value <strong>does not</strong> respect this contract.</dt>
<dd>Raises an exception if it does.</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Raise :</th><td class="field-body">ValueError</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="contracts.Contract.__repr__">
<tt class="descname">__repr__</tt><big>(</big><big>)</big><a class="headerlink" href="#contracts.Contract.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a string representation of a contract that can be 
evaluated by Python&#8217;s <a class="reference external" href="http://docs.python.org/library/functions.html#eval" title="(in Python v2.7)"><tt class="xref py py-func docutils literal"><span class="pre">eval()</span></tt></a>.</p>
<p>It must hold that: <tt class="docutils literal"><span class="pre">eval(contract.__repr__())</span> <span class="pre">==</span> <span class="pre">contract</span></tt>.
This is checked in the unit-tests.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s">&#39;list[N]&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>
<span class="go">&quot;List(BindVariable(&#39;N&#39;,int),None)&quot;</span>
</pre></div>
</div>
<p>All the symbols you need to eval() the expression are in 
<tt class="xref py py-mod docutils literal"><span class="pre">contracts.library</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">contracts.library</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span> <span class="o">==</span> <span class="nb">eval</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%r</span><span class="s">&quot;</span><span class="o">%</span><span class="n">contract</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="contracts.Contract.__str__">
<tt class="descname">__str__</tt><big>(</big><big>)</big><a class="headerlink" href="#contracts.Contract.__str__" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a string representation of a contract that can be 
reparsed by <a class="reference internal" href="#contracts.parse" title="contracts.parse"><tt class="xref py py-func docutils literal"><span class="pre">contracts.parse()</span></tt></a>.</p>
<p>It must hold that: <tt class="docutils literal"><span class="pre">parse(str(contract))</span> <span class="pre">==</span> <span class="pre">contract</span></tt>.
This is checked in the unit-tests.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spec</span> <span class="o">=</span> <span class="s">&#39;list[N]&#39;</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span>
<span class="go">List(BindVariable(&#39;N&#39;,int),None)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span> <span class="o">==</span> <span class="n">spec</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The expressions generated by <a class="reference internal" href="#contracts.Contract.__str__" title="contracts.Contract.__str__"><tt class="xref py py-func docutils literal"><span class="pre">Contract.__str__()</span></tt></a> will be
exactly the same as what was parsed (this is checked in the 
unittests as well) if and only if the expression is &#8220;minimal&#8221;. 
If it isn&#8217;t (there is whitespace or redundant symbols), 
the returned expression will be an equivalent minimal one.</p>
<p>Example with extra parenthesis and whitespace:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">contracts</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">verbose_spec</span> <span class="o">=</span> <span class="s">&#39;list[((N))]( int, &gt; 0)&#39;</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">contract</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">verbose_spec</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
<span class="go">&#39;list[N](int,&gt;0)&#39;</span>
</pre></div>
</div>
<p>Example that removes extra parentheses around arithmetic operators:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">verbose_spec</span> <span class="o">=</span> <span class="s">&#39;=1+(1*2)+(2+4)&#39;</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">verbose_spec</span><span class="p">))</span>
<span class="go">&#39;=1+1*2+2+4&#39;</span>
</pre></div>
</div>
<p>This is an example with logical operators precedence. The AND
operator <tt class="docutils literal"><span class="pre">,</span></tt> (comma) has more precedence than the OR (<tt class="docutils literal"><span class="pre">|</span></tt>).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">verbose_spec</span> <span class="o">=</span> <span class="s">&#39;(a|(b,c)),e&#39;</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">parse</span><span class="p">(</span><span class="n">verbose_spec</span><span class="p">))</span>
<span class="go">&#39;(a|b,c),e&#39;</span>
</pre></div>
</div>
<p>Not that only the outer parenthesis is kept as it is the only one 
needed.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="contracts.Context">
<em class="property">class </em><tt class="descclassname">contracts.</tt><tt class="descname">Context</tt><a class="headerlink" href="#contracts.Context" title="Permalink to this definition">¶</a></dt>
<dd><p>Class that represents the context for checking an expression.</p>
<p>For now it is mostly a glorified dictionary, but perhaps in the
future it will be something more.</p>
<dl class="method">
<dt id="contracts.Context.__contains__">
<tt class="descname">__contains__</tt><big>(</big><big>)</big><a class="headerlink" href="#contracts.Context.__contains__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="contracts.Context.__getitem__">
<tt class="descname">__getitem__</tt><big>(</big><big>)</big><a class="headerlink" href="#contracts.Context.__getitem__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<dl class="data">
<dt id="contracts.contract_expression">
<tt class="descclassname">contracts.</tt><tt class="descname">contract_expression</tt><a class="headerlink" href="#contracts.contract_expression" title="Permalink to this definition">¶</a></dt>
<dd><p>A PyParsing expression that can be used to include
contracts expression in your own PyParsing grammar.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">PyContracts</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#quick-tour">Quick tour</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pycontracts-api">PyContracts API</a><ul>
<li><a class="reference internal" href="#using-the-contracts-decorator">Using the <tt class="docutils literal"><span class="pre">&#64;contracts</span></tt> decorator.</a><ul>
<li><a class="reference internal" href="#using-decorator-arguments">Using decorator arguments</a></li>
<li><a class="reference internal" href="#using-python-annotations">Using Python annotations</a></li>
<li><a class="reference internal" href="#using-functions-docstrings">Using functions docstrings</a></li>
<li><a class="reference internal" href="#decorating-a-function-explicitly">Decorating a function explicitly</a></li>
</ul>
</li>
<li><a class="reference internal" href="#manual-api">Manual API</a><ul>
<li><a class="reference internal" href="#interpreting-error-messages">Interpreting error messages</a></li>
<li><a class="reference internal" href="#explicit-parsing-and-checking">Explicit parsing and checking</a></li>
<li><a class="reference internal" href="#checking-multiple-values">Checking multiple values</a></li>
<li><a class="reference internal" href="#examining-the-contract-objects">Examining the Contract objects</a></li>
<li><a class="reference internal" href="#examining-bound-variables">Examining bound variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extending-pycontracts-with-new-contracts">Extending <span class="brand">PyContracts</span> with new contracts</a></li>
<li><a class="reference internal" href="#using-pycontracts-in-your-own-pyparsing-based-language">Using PyContracts in your own PyParsing-based language</a></li>
</ul>
</li>
<li><a class="reference internal" href="#language-reference">Language reference</a><ul>
<li><a class="reference internal" href="#simple-types">Simple types</a></li>
<li><a class="reference internal" href="#variables">Variables</a></li>
<li><a class="reference internal" href="#logical-expressions">Logical expressions</a></li>
<li><a class="reference internal" href="#equality">Equality</a></li>
<li><a class="reference internal" href="#arithmetic-and-comparison">Arithmetic and comparison</a></li>
<li><a class="reference internal" href="#details-of-variable-binding">Details of variable binding</a></li>
<li><a class="reference internal" href="#lists">Lists</a></li>
<li><a class="reference internal" href="#tuples">Tuples</a></li>
<li><a class="reference internal" href="#dictionaries">Dictionaries</a></li>
<li><a class="reference internal" href="#numpy-arrays">Numpy arrays</a><ul>
<li><a class="reference internal" href="#shape-contracts">Shape contracts</a></li>
<li><a class="reference internal" href="#numpy-specific-contracts">Numpy-specific contracts</a></li>
<li><a class="reference internal" href="#other-examples">Other examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-topic-the-context-isolate-operator">Advanced topic: the context isolate operator</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pycontracts-public-api-reference">PyContracts public API reference</a><ul>
<li><a class="reference internal" href="#decorating-a-function">Decorating a function</a></li>
<li><a class="reference internal" href="#exceptions">Exceptions</a></li>
<li><a class="reference internal" href="#manually-checking-values">Manually checking values</a></li>
<li><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">PyContracts v0.9.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
	
    <div class="footer">
        &copy; Copyright 2010, Andrea Censi.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.5.
    </div>
	
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-155626-14']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>


  </body>
</html>